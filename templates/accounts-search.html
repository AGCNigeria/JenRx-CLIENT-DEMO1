<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Search Accounts
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-book active"></i><i class="fa fa-search active"></i> Search Accounts</a></li>
  </ol>
</section>

<!-- Main content -->
<section class="content">

  <div class="box box-primary">
    <div class="box-header with-border">
      <h3 class="box-title">Search Accounts</h3>
      <div class="box-tools pull-right">
        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
        <button type="button" class="btn btn-box-tool" data-widget="remove" onclick='$("#accounts-content").html("");'><i class="fa fa-times"></i></button>
      </div>
    </div>
    <div class="box-body">

      <form id="form-accounts-search" class="form-horizontal">
        <div class="col-md-12">
          <div class="form-group">
            <button type="button" class="btn btn-primary btn-flat col-md-3 col-sm-3" onclick='accountSearchDate(new Date(), new Date());'>Today</button>
            <button type="button" class="btn btn-primary btn-flat col-md-3 col-sm-3" onclick='var yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); accountSearchDate(yesterday, yesterday);'>Yesterday</button>
            <button type="button" class="btn btn-primary btn-flat col-md-3 col-sm-3" onclick='var sevendays = new Date(); sevendays.setDate(sevendays.getDate() - 7); accountSearchDate(sevendays, new Date());'>Past 7 Days</button>
            <button type="button" class="btn btn-primary btn-flat col-md-3 col-sm-3" onclick='var thirtydays = new Date(); thirtydays.setDate(thirtydays.getDate() - 30); accountSearchDate(thirtydays, new Date());'>Past 30 Days</button>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="startDate" class="col-sm-4 control-label">Start Date</label>

            <div class="col-sm-8">
              <div class="input-group">
                <input type="text" class="form-control" name="startDate" id="startDate" placeholder="Start Date" required>
                <span class="input-group-addon"><label for="startDate"><i class="fa fa-calendar"></i></label></span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="startTime" class="col-sm-4 control-label">Start Time</label>

            <div class="col-sm-8 bootstrap-timepicker">
              <div class="input-group">
                <input type="text" class="form-control" name="startTime" id="startTime" placeholder="Start Time" required>
                <span class="input-group-addon"><label for="startTime"><i class="fa fa-clock-o"></i></label></span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="endDate" class="col-sm-4 control-label">End Date</label>

            <div class="col-sm-8">
              <div class="input-group">
                <input type="text" class="form-control" name="endDate" id="endDate" placeholder="End Date" required>
                <span class="input-group-addon"><label for="endDate"><i class="fa fa-calendar"></i></label></span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="endTime" class="col-sm-4 control-label">End Time</label>

            <div class="col-sm-8 bootstrap-timepicker">
              <div class="input-group">
                <input type="text" class="form-control" name="endTime" id="endTime" placeholder="End Time" required>
                <span class="input-group-addon"><label for="endTime"><i class="fa fa-clock-o"></i></label></span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="box box-primary collapsed-box">
            <div class="box-header with-border">
              <h3 class="box-title"><a href="#"><small class="text-primary" data-widget="collapse"><i class="fa fa-filter"></i> Filter Search <i class="fa fa-search"></i></small></a></h3>

              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse">
                  <i class="fa fa-plus"></i>
                </button>
              </div>
              <!-- /.box-tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <div class="form-group">
                <label for="payment" class="col-sm-2 control-label">Payment</label>
                <div class="col-sm-10">
                  <div class="input-group">
                    <select class="form-control" name="payment" id="payment" placeholder="Payment" style="width: 100%;">
                      <option value="">Select Payment</option>
                      <option value="cash">Cash</option>
                      <option value="pos">POS</option>
                      <option value="transfer">Transfer</option>
                      <option value="cheque">Cheque</option>
                      <option value="credit">Credit</option>
                    </select>
                    <span class="input-group-addon"><i class="fa fa-money"></i></span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="inventory" class="col-sm-2 control-label">Inventory</label>

                <div class="col-sm-10">
                  <div class="input-group">
                    <select class="form-control" name="inventory" id="inventory" placeholder="Search Inventory" style="width: 100%;">
                    </select>
                    <span class="input-group-addon"><i class="fa fa-list-alt"></i></span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="customer" class="col-sm-2 control-label">Customer</label>

                <div class="col-sm-10">
                  <div class="input-group">
                    <select class="form-control" name="customer" id="customer" placeholder="Search Customer" style="width: 100%;">
                    </select>
                    <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="user" class="col-sm-2 control-label">Staff</label>

                <div class="col-sm-10">
                  <div class="input-group">
                    <select class="form-control" name="user" id="user" placeholder="Search Staff" style="width: 100%;">
                    </select>
                    <span class="input-group-addon"><i class="fa fa-user"></i></span>
                  </div>
                </div>
              </div>
              <div class="form-group clinical-feature">
                <label for="info" class="col-sm-2 control-label">Clinical Information</label>

                <div class="col-sm-10">
                  <div class="input-group">
                    <input type="text" class="form-control" name="info" id="info" placeholder="Clinical Information">
                    <span class="input-group-addon"><i class="fa fa-file-text-o"></i></span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="status" class="col-sm-2 control-label">Status</label>
                <div class="col-sm-10">
                  <div class="input-group">
                    <select class="form-control" name="status" id="status" placeholder="Status" style="width: 100%;" required>
                      <option value="">Select Status</option>
                      <option value="pending">Pending</option>
                      <option value="complete" selected>Complete</option>
                      <option value="refund">Refund</option>
                    </select>
                    <span class="input-group-addon"><i class="fa fa-question"></i></span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                  <button type="reset" class="btn btn-primary btn-sm" onclick='$("#inventory").empty().trigger("change");$("#customer").empty().trigger("change");$("#user").empty().trigger("change");'><i class="fa fa-undo"></i> &nbsp; Reset</button>
                </div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-success"><i class="fa fa-search"></i> &nbsp; Search Accounts</button>
          </div>
        </div>
      </form>
      <div class="table-responsive" id="accounts-search-result">
        <div class="col-md-12">
          <div class="form-group">
            <button type="button" class="btn btn-class btn-lg btn-flat col-md-4 col-sm-4">Sales: <span id="account-search-sales"></span></button>
            <button type="button" class="btn btn-class btn-lg btn-flat col-md-4 col-sm-4">Total: <span id="account-search-total"></span></button>
            <button type="button" class="btn btn-class btn-lg btn-flat col-md-4 col-sm-4">Profit: <span id="account-search-profit"></span></button>
            <button type="button" class="btn btn-class btn-lg btn-flat col-md-4 col-sm-4">Discount: <span id="account-search-discount"></span></button>
            <button type="button" class="btn btn-class btn-lg btn-flat col-md-4 col-sm-4">Tax: <span id="account-search-tax"></span></button>
            <button type="button" class="btn btn-class btn-lg btn-flat col-md-4 col-sm-4">Credit: <span id="account-search-credit"></span></button>
            <br><br><br><br><br>

            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 pro-feature" id="accounts-charts-div">
              <!-- small box -->
              <div class="small-box bg-primary">
                <div class="inner">
                  <a href="#" onclick='loader("html-content", "popup", "accounts-charts", "", "", false);'>
                    <h3 class="text-white">Charts</h3>
                  </a>

                  <a href="#" onclick='loader("html-content", "popup", "accounts-charts", "", "", false);'>
                    <p class="text-white">Charts Accounts</p>
                  </a>
                </div>
                <div class="icon">
                  <a href="#" onclick='loader("html-content", "popup", "accounts-charts", "", "", false);'>
                    <i class="fa fa-book text-white"></i>
                    <i class="fa fa-line-chart text-white"></i>
                  </a>
                </div>
                <a href="#" onclick='loader("html-content", "popup", "accounts-charts", "", "", false);' class="small-box-footer text-white">Charts Accounts <i class="fa fa-arrow-circle-right text-white"></i></a>
              </div>
            </div>
            <!-- ./col -->

          </div>
        </div>
        <table id="table-accounts-search" class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>#</th>
              <th>Transaction</th>
              <th>Staff</th>
              <th>Customer</th>
              <th>Inventory</th>
              <th>Total</th>
              <th>Discount (%)</th>
              <th>Paid</th>
              <th>Payment</th>
              <th>Tax (%)</th>
              <th>Profit</th>
              <th class="clinical-feature">Additional Clinical Information</th>
              <th>Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="account-search-list">
          </tbody>
          <tfoot>
            <tr>
              <th>#</th>
              <th>Transaction</th>
              <th>Staff</th>
              <th>Customer</th>
              <th>Inventory</th>
              <th>Total</th>
              <th>Discount (%)</th>
              <th>Paid</th>
              <th>Payment</th>
              <th>Tax (%)</th>
              <th>Profit</th>
              <th class="clinical-feature">Additional Clinical Information</th>
              <th>Date</th>
              <th>Status</th>
            </tr>
          </tfoot>
        </table>
      </div>
      <div id="table-accounts-search-loader"></div>
    </div>
    <!-- /.box-body -->
  </div>
  <!-- /.box -->

</section>
<!-- /.content -->
<!-- page script -->
<script>
  $(function () {
    loadTableIncomeStatementAccountsSearch = undefined;
    $("#form-accounts-search #startDate").datepicker({
      autoclose: true,
      format: "yyyy-mm-dd"
    });
    $("#form-accounts-search #startTime").timepicker({
      showInputs: false,
      defaultTime: "12:00 AM"
    });
    $("#form-accounts-search #endDate").datepicker({
      autoclose: true,
      format: "yyyy-mm-dd"
    });
    $("#form-accounts-search #endTime").timepicker({
      showInputs: false,
      defaultTime: "11:59 PM"
    });
    select2Search("inventory", "form-accounts-search #inventory");
    select2Search("customers", "form-accounts-search #customer");
    select2Search("users", "form-accounts-search #user");
    $("#accounts-search-result").hide();
    $("#accounts-charts-div").hide();
    $("#form-accounts-search").submit(function(e){
      e.preventDefault(e);
      $("button").attr("disabled", "disabled");
      $("#accounts-search-result").hide();
      $(".btn-class").removeClass("btn-warning");
      $(".btn-class").removeClass("btn-success");
      $(".btn-class").removeClass("btn-danger");
      if ($("#status").val() == "pending") {
        $(".btn-class").addClass("btn-warning");
      }
      else if ($("#status").val() == "complete") {
        $(".btn-class").addClass("btn-success");
      }
      else if ($("#status").val() == "refund") {
        $(".btn-class").addClass("btn-danger");
      }
      else {

      }
      var startDate = new Date($("#form-accounts-search #startDate").val() + ' ' + $("#form-accounts-search #startTime").val());
      startDate = startDate.getFullYear() + '-' + (startDate.getMonth() + 1).toString().padStart(2, "0") + '-' + startDate.getDate().toString().padStart(2, "0") + ' ' + startDate.getHours().toString().padStart(2, "0") + ':' + startDate.getMinutes().toString().padStart(2, "0") + ':' + '00';
      var endDate = new Date($("#form-accounts-search #endDate").val() + ' ' + $("#form-accounts-search #endTime").val());
      endDate = endDate.getFullYear() + '-' + (endDate.getMonth() + 1).toString().padStart(2, "0") + '-' + endDate.getDate().toString().padStart(2, "0") + ' ' + endDate.getHours().toString().padStart(2, "0") + ':' + endDate.getMinutes().toString().padStart(2, "0") + ':' + '59';
      loader("table-accounts-search-loader", "py", 'sales/accounts/search', { startDate: startDate, endDate: endDate, payment: $("#form-accounts-search #payment").val(), inventory: $("#form-accounts-search #inventory").val(), customer: $("#form-accounts-search #customer").val(), user: $("#form-accounts-search #user").val(), info: $("#form-accounts-search #info").val(), status: $("#form-accounts-search #status").val() }, "", true);
    });
    accountSearchDate(new Date(), new Date());
  });
  function accountSearchDate(startDate, endDate) {
    var startDate = startDate.getFullYear() + '-' + (startDate.getMonth() + 1).toString().padStart(2, "0") + '-' + startDate.getDate().toString().padStart(2, "0");
    var endDate = endDate.getFullYear() + '-' + (endDate.getMonth() + 1).toString().padStart(2, "0") + '-' + endDate.getDate().toString().padStart(2, "0");
    $("#form-accounts-search #startDate").val(startDate);
    $("#form-accounts-search #startTime").val("12:00 AM");
    $("#form-accounts-search #endDate").val(endDate);
    $("#form-accounts-search #endTime").val("11:59 PM");
    $("#form-accounts-search").trigger("submit");
  }
  function loadTableAccountSearch(data) {
    var account_list = "";
    var id = 1;
    var sales_ = 0;
    var total_ = 0;
    var profit_ = 0;
    var discount_ = 0;
    var tax_ = 0;
    var credit_ = 0;
    var chart_array_totalprofit = [];
    var chart_array_inventory = [];
    for (var i = 0; i < data.length; i++) {
      if (data[i].cart_id) {
        var p = i - 1;
        var n = i + 1;
        if (i != 0 && data[p].sales_id == data[i].sales_id) {
          var inventory = inventory + '<br>' + data[i].name + ' (' + data[i].cart_quantity + ')';
          var sales = sales + data[i].cart_total;
        }
        else {
          var transaction = data[i].sales_id;
          var print = '<button type="button" class="btn btn-primary btn-flat" onclick="printTransaction(' + transaction + ');"><i class="fa fa-print"></i> &nbsp; Print</button>';
          var staff = data[i].users_title + ' ' + data[i].users_firstname + ' ' + data[i].users_lastname;
          if (data[i].customers_title !== null && data[i].customers_firstname !== null && data[i].customers_lastname !== null) {
            var customer = data[i].customers_title + ' ' + data[i].customers_firstname + ' ' + data[i].customers_lastname;
          }
          else {
            var customer = "";
          }
          var inventory = data[i].name + ' (' + data[i].cart_quantity + ')';
          var sales = data[i].cart_total;
          if (data[i].total) {
            var total = data[i].total.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");
          }
          else {
            var total = "";
          }
          if ($("#form-accounts-search #inventory").val()) {
            var total = data[i].cart_total.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");
          }
          if (data[i].discount) {
            var discount = data[i].discount.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");
          }
          else {
            var discount = "";
          }
          if (data[i].paid) {
            var paid = data[i].paid.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");
          }
          else {
            var paid = "";
          }
          if (data[i].payment == "credit") {
            var sales_data = {
              customer: data[i].customer_id,
              totalDT: data[i].total,
              discount: data[i].discount,
              paid: data[i].paid,
              payment: data[i].payment,
              tax: data[i].tax,
              profit: data[i].profit,
              info: data[i].info.replace(/'/g, "&#39;").replace(/"/g, "&#39;&#39;"),
              userID: data[i].user_id,
              salesID: data[i].sales_id,
              salesStatus: "complete",
              updateType: "payment"
            }
            var payment = data[i].payment.toUpperCase() + '<br>' + '<button type="button" class="btn btn-warning btn-flat" onclick=\'paymentTransactionConfirm("table-accounts-search-loader", ' + JSON.stringify(JSON.stringify(sales_data)) + ');\'">Update Payment</button>';
          }
          else {
            var payment = data[i].payment.toUpperCase();
          }
          if (data[i].tax) {
            var tax = data[i].tax.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");
          }
          else {
            var tax = "";
          }
          if (data[i].profit) {
            var profit = data[i].profit.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");
          }
          else {
            var profit = "";
          }
          if ($("#form-accounts-search #inventory").val()) {
            var profit = data[i].cart_profit.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");
          }
          var info = data[i].info;
          var date = data[i].sales_time;
          if (data[i].status == "pending") {
            var status = '<button type="button" class="btn btn-warning btn-flat" onclick="printTransaction(' + transaction + ');">' + data[i].status.toUpperCase() + '</button>';
            var refund = '';
          }
          else if (data[i].status == "complete") {
            var status = '<button type="button" class="btn btn-success btn-flat" onclick="printTransaction(' + transaction + ');">' + data[i].status.toUpperCase() + '</button>';
            var sales_data = {
              customer: data[i].customer_id,
              totalDT: data[i].total,
              discount: data[i].discount,
              paid: data[i].paid,
              payment: data[i].payment,
              tax: data[i].tax,
              profit: data[i].profit,
              info: data[i].info.replace(/'/g, "&#39;").replace(/"/g, "&#39;&#39;"),
              userID: data[i].user_id,
              salesID: data[i].sales_id,
              salesStatus: "refund",
              updateType: "status"
            }
            var refund = '<button type="button" class="btn btn-danger btn-flat" onclick=\'refundTransactionConfirm("table-accounts-search-loader", ' + JSON.stringify(JSON.stringify(sales_data)) + ');\'><i class="fa fa-exchange"></i> &nbsp; Refund</button>';
          }
          else if (data[i].status == "refund") {
            var status = '<button type="button" class="btn btn-danger btn-flat" onclick="printTransaction(' + transaction + ');">' + data[i].status.toUpperCase() + '</button>';
            var refund = '';
          }
          else {

          }
        }
        if ((n < data.length && data[n].sales_id != data[i].sales_id) || n == data.length) {
          account_list = account_list + '<tr>' +
              '<td>' + id + '</td>' +
              '<td>' + transaction + print + '</td>' +
              '<td>' + staff + '</td>' +
              '<td>' + customer + '</td>' +
              '<td>' + inventory + '</td>' +
              '<td>' + total + '</td>' +
              '<td>' + discount + '</td>' +
              '<td>' + paid + '</td>' +
              '<td>' + payment + '</td>' +
              '<td>' + tax + '</td>' +
              '<td>' + profit + '</td>' +
              '<td class="clinical-feature">' + info + '</td>' +
              '<td>' + date + '</td>' +
              '<td>' + status + refund + '</td>' +
            '</tr>';
            sales_ = sales_ + sales;
            if (data[i].total && !$("#form-accounts-search #inventory").val()) {
              total_ = total_ + data[i].total;
            }
            else {
              total_ = total_ + data[i].cart_total;
            }
            if (data[i].profit && !$("#form-accounts-search #inventory").val()) {
              profit_ = profit_ + data[i].profit;
            }
            else {
              profit_ = profit_ + data[i].cart_profit;
            }
            if (data[i].discount) {
              discount_ = discount_ + ((data[i].discount / 100) * sales);
            }
            if (data[i].tax) {
              tax_ = tax_ + ((data[i].tax / 100) * (sales - ((data[i].discount / 100) * sales)));
            }
            if (data[i].payment == "credit") {
              if (!$("#form-accounts-search #inventory").val()) {
                credit_ = credit_ + data[i].total;
              }
              else {
                credit_ = credit_ + data[i].cart_total;
              }
            }
            id++;
        }
        else {

        }
      }
      var chart_date = new Date(data[i].sales_time);
      var chart_date_format = chart_date.getFullYear() + '-' + (chart_date.getMonth() + 1).toString().padStart(2, "0") + '-' + chart_date.getDate().toString().padStart(2, "0");
      if (chart_array_totalprofit.some(e => e.date === chart_date_format)) {
        var array_index = chart_array_totalprofit.findIndex(e => e.date === chart_date_format);
        chart_array_totalprofit[array_index].total = chart_array_totalprofit[array_index].total + data[i].cart_total;
        chart_array_totalprofit[array_index].profit = chart_array_totalprofit[array_index].profit + data[i].cart_profit;
      }
      else {
        chart_array_totalprofit.push({
          date: chart_date_format,
          total: data[i].cart_total,
          profit: data[i].cart_profit
        });
      }
      if (chart_array_inventory.some(e => e.inventory === data[i].name)) {
        var array_index = chart_array_inventory.findIndex(e => e.inventory === data[i].name);
        chart_array_inventory[array_index].quantity = chart_array_inventory[array_index].quantity + data[i].cart_quantity;
        chart_array_inventory[array_index].total = chart_array_inventory[array_index].total + data[i].cart_total;
        chart_array_inventory[array_index].profit = chart_array_inventory[array_index].profit + data[i].cart_profit;
      }
      else {
        chart_array_inventory.push({
          inventory: data[i].name,
          quantity: data[i].cart_quantity,
          total: data[i].cart_total,
          profit: data[i].cart_profit
        });
      }
    }
    if ($("#form-accounts-search #status").val() == "pending") {
      var total_ = 0;
      var profit_ = 0;
    }
    $("#table-accounts-search").DataTable().destroy();
    $("#table-accounts-search-loader").html("");
    $("#account-search-list").html(account_list);
    $("#account-search-sales").html(getStorage("settingsSalesCurrency") + sales_.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));
    $("#account-search-total").html(getStorage("settingsSalesCurrency") + total_.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));
    $("#account-search-profit").html(getStorage("settingsSalesCurrency") + profit_.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));
    $("#account-search-discount").html(getStorage("settingsSalesCurrency") + discount_.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));
    $("#account-search-tax").html(getStorage("settingsSalesCurrency") + tax_.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));
    $("#account-search-credit").html(getStorage("settingsSalesCurrency") + credit_.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","));
    var titleAttr = 'Accounts - ' + $("#form-accounts-search #startDate").val() + ' ' + $("#form-accounts-search #startTime").val() + ' - ' + $("#form-accounts-search #endDate").val() + ' ' + $("#form-accounts-search #endTime").val() + '\n' + ' Sales ' + $("#account-search-sales").html() + ' Total ' + $("#account-search-total").html() + '\n' + ' Profit ' + $("#account-search-profit").html() + ' Discount ' + $("#account-search-discount").html() + ' Tax ' + $("#account-search-tax").html();
    dataTablesButtons("table-accounts-search", titleAttr);
    $("#table-accounts-search").DataTable().column(11).visible($.parseJSON(getStorage("settingsAppClinicalFeature")));
    $("#accounts-search-result").show();
    $("#accounts-charts-div").show();
    setStorage("jenrxChartArrayTotalProfit", JSON.stringify(chart_array_totalprofit));
    setStorage("jenrxChartArrayInventory", JSON.stringify(chart_array_inventory));
  }
  function printTransaction(invoice) {
    loader("receipt-content", "py", 'sales/search/invoice/' + invoice, { salesIDInvoice: invoice }, "", false);
  }
  function refundTransactionConfirm(htmlID, sales_data) {
    sales_data = $.parseJSON(sales_data);
    var content = '<div class="row">' +
        '<div class="form-group">' +
            '<label for="submit" class="col-sm-12 control-label">Are you sure you want to refund transaction ' + sales_data.salesID + ' ?</label>' +
          '<div class="col-sm-12">' +
            '<button type="submit" class="btn btn-danger" data-dismiss="modal" onclick=\'$(".modal-backdrop").remove();loader("receipt-content", "templates", "print-receipt", "", "", false);refundTransaction("' + htmlID + '", ' + JSON.stringify(JSON.stringify(sales_data)) + ');\'><i class="fa fa-check"></i> &nbsp; YES</button> ' +
            '<button type="reset" class="btn btn-success" data-dismiss="modal"><i class="fa fa-times"></i> &nbsp; NO</button>' +
          '</div>' +
        '</div>' +
      '</div>';
    popupModal("Confirm", content, "warning", htmlID);
  }
  function paymentTransactionConfirm(htmlID, sales_data) {
    sales_data = $.parseJSON(sales_data);
    var content = '<div class="row">' +
        '<div class="form-group">' +
            '<label for="payment" class="col-sm-12 control-label">Are you sure you want to change payment for transaction ' + sales_data.salesID + ' ?</label>' +
            '<div class="form-group">' +
              '<label for="paid">Paid</label>' +
              '<input type="number" value="' + sales_data.paid + '" min="0" step="0.01" class="form-control" name="paid" id="' + sales_data.salesID + '-paid" placeholder="Paid" required>' +
            '</div>' +
            '<div class="form-group">' +
              '<label for="payment">Payment</label>' +
              '<select class="form-control" name="payment" id="' + sales_data.salesID + '-payment" placeholder="Payment" style="width: 100%;" required>' +
                '<option value="">Select Payment</option>' +
                '<option value="cash" selected>Cash</option>' +
                '<option value="pos">POS</option>' +
                '<option value="transfer">Transfer</option>' +
                '<option value="cheque">Cheque</option>' +
                '<option value="credit" selected>Credit</option>' +
              '</select>' +
            '</div>' +
          '<div class="col-sm-12">' +
            '<button type="submit" class="btn btn-success" data-dismiss="modal" onclick=\'$(".modal-backdrop").remove();loader("receipt-content", "templates", "print-receipt", "", "", false);paymentTransaction("' + htmlID + '", ' + JSON.stringify(JSON.stringify(sales_data)) + ');\'><i class="fa fa-check"></i> &nbsp; YES</button> ' +
            '<button type="reset" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-times"></i> &nbsp; NO</button>' +
          '</div>' +
        '</div>' +
      '</div>';
    popupModal("Confirm", content, "warning", htmlID);
  }
  function paymentTransaction(htmlID, sales_data) {
    sales_data = $.parseJSON(sales_data);
    var totalDT = parseFloat(sales_data.totalDT);
    var paid = parseFloat($('#' + sales_data.salesID + '-paid').val());
    var payment = $('#' + sales_data.salesID + '-payment').val();
    if (paid >= totalDT || payment === "credit") {
      $("button").attr("disabled", "disabled");
      sales_data.paid = paid;
      sales_data.payment = payment;
      loader(htmlID, "py", 'sales/complete/' + sales_data.salesID, sales_data, "", true);
    }
    else {
      xhr = {};
      xhr.statusText = "Error";
      xhr.responseText = 'Insufficient Amount Paid <br>' + getStorage("settingsSalesCurrency") + paid.toFixed(2) + ' is less than ' + getStorage("settingsSalesCurrency") + totalDT.toFixed(2);
      errorHandler(xhr, htmlID);
    }
  }
</script>
